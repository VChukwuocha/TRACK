<!DOCTYPE html>

<html>
<head>
  <title>Profile</title>
  <%- include("../partials/head.ejs")%>
</head>


<div class="grid-container">

  <%- include("../partials/header.ejs")%>

  <main class="main">
    <div class="class-header">
      <h3><%= student.firstname %>'s Profile</h3>
      <div class = "nameArea" style="grid-template-columns: repeat(2, 2fr);">
        
        <button type="button" class="btn btn-info" onclick="toggleInfo()" id="infoButton">Show Info</button>

        <button type="button" class="btn btn-primary">
          <a href="/student/<%= student.id%>/student_edit">Edit Student</a>
        </button>
      </div>
      

      <!--<a href="/student/<%=student.id%>/createNewGoal">
        <button class="btn btn-secondary my-2 my-sm-0" type="submit">Create Goal</button>
      </a>-->
      
    </div>

    <div class = "overviewcard" id="studentsInfoBox" style="display: none; grid-template-columns: auto">
      Date of Birth: <span id="dob"></span> <br>
      Email: <%= student.email %> <br>
      Grade Level: <%= student.grade %> <br>
      Class Period: <%= student.period %> <br> <br>
      <form action="/student/<%=student.id%>/addDocumentation">
        Documentation: <input type="file" name="myFile" multiple>
        <input type="submit">

        <div class="gallery">
          <a target="_blank" href="/student/<%= student.id %>/getPicture">
            <img src="/student/<%= student.id %>/getPicture" alt="Cinque Terre" width="600" height="400">
          </a>
          <div class="desc">Add a description of the image here</div>
        </div>
          <script type="text/javascript">
            function launchOneDrivePicker(){
              var odOptions = { /* ... specify the desired options ... */ };
              OneDrive.open(odOptions);
            }
          </script>
          <button onClick="launchOneDrivePicker()">Open from OneDrive</button>
          <script type="text/javascript" src="https://js.live.net/v7.2/OneDrive.js">
            var odOptions = {
              clientId: "f4238741-ebe5-4017-94b5-4de9dc3c20b8",
              action: "query",
              multiSelect: true,
              advanced: {},
              success: function(files) { /* success handler */ },
              cancel: function() { /* cancel handler */ },
              error: function(error) { /* error handler */ }
            }
          </script>
      </form>
    </div>

    <div class = "overviewcard" id="goalsBox">

      <% goals.forEach(function(goal) { %> 

      <div class = "cardName">
        <div class="card text-white bg-primary mb-3" style="max-width: 20rem;">
          <a href="/student/<%=student.id%>/goal/<%=goal.id%>">
            <div class="card-header"><%=goal.goalType%></div>
            <div class="card-body">
              <h4 class="card-title"><%= goal.name %></h4>
              <p class="card-text">Goal Progress</p>
              <div class="progress">
               <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%">
               </div>
             </div>
           </div>
         </a>
       </div>
     </div>
     <% }); %>
     <div class="cardName">
      <div class="card text-white bg-primary mb-3" style="max-width: 20rem">
        <a href="/student/<%=student.id%>/createNewGoal">
          <div class="card-body">
            <p class="card-text">Create New Goal</p>
            <h4 class="card-title" style="font-size: 400%; text-align: center">+</h4>
          </div>
        </div>
      </div>
    </div>


</main>

<footer class="footer">
  <div class="footer__copyright">&copy; 2019 TRACK</div>
  
  <a href="/student/<%= student.id %>/delete" class="Delete" style="color: black"> <div class="footer__signature">Delete Student</div></a>
</footer>
</div>

</html>

<script>
  function toggleInfo() {
    // toggle's between showing all the student goals or showing student profile information
    var infoButton = document.getElementById('infoButton');
    if(infoButton.innerHTML == "Show Info") { //if we are already showing goals, switch to showing info
      infoButton.innerHTML = "Show Goals";

      var goalsBox = document.getElementById('goalsBox');
      goalsBox.style.display='none';
      var studentsInfoBox = document.getElementById('studentsInfoBox');
      studentsInfoBox.style.display='inline-block';
    } else { // else if we are already showing info, show goals
      infoButton.innerHTML = "Show Info";
      var goalsBox = document.getElementById('goalsBox');
      goalsBox.style.display='';
      var studentsInfoBox = document.getElementById('studentsInfoBox');
      studentsInfoBox.style.display='none';
    }
    
  }

  convertToMMDDYYYY("<%=student.dob%>"); //executes as soon as page is loaded

  function convertToMMDDYYYY(d) {
    // convert student date of birth stored in MongoDB to readable and displayable form
    date = new Date(d);
    year = date.getFullYear();
    month = date.getMonth()+1;
    dt = date.getDate()+1;

    if (dt < 10) {
      dt = '0' + dt;
    }
    if (month < 10) {
      month = '0' + month;
    }
    var format = String(year)+'-' + String(month) + '-'+String(dt);
    console.log("formatted year: " + format);
    document.getElementById('dob').innerHTML = format;
  }
</script>